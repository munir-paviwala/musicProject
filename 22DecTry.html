<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Floating Music Map</title>
    <style>
        body { margin: 0; background: #050505; color: white; font-family: 'Courier New', sans-serif; overflow: hidden; }
        #canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; mix-blend-mode: difference; }
        
        #now-playing {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            /* Glassmorphism effect */
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 15px 40px;
            border-radius: 50px; display: none; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>

<div id="ui">
    <h2>Phase 4: "Alive"</h2>
    <p>Scroll to Zoom | WASD to Float</p>
</div>

<div id="now-playing">
    <div id="np-title" style="font-weight:bold; letter-spacing: 1px;">Song Title</div>
    <div style="font-size:0.7em; opacity:0.7; margin-top:5px;">LISTENING NOW</div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const npBox = document.getElementById('now-playing');
const npTitle = document.getElementById('np-title');

// ==========================================
// 1. DATA (With randomized float offsets)
// ==========================================
const anchors = [
    { x: -300, y: -300, color: "#800020", radius: 900 }, // Burgundy
    { x: 500, y: 400, color: "#004d40", radius: 900 },   // Teal
    { x: 100, y: 100, color: "#1a237e", radius: 700 }    // Deep Indigo
];

const songs = [
    // Added 'offset' so they don't all bob up and down in perfect sync (looks robotic)
    { id: "P1", x: -200, y: -200, title: "Drift Phonk", offset: Math.random() * 100 },
    { id: "P2", x: -80, y: -280, title: "Cowbell Cult", offset: Math.random() * 100 },
    { id: "G1", x: 400, y: 300, title: "Gotilo", offset: Math.random() * 100 },
    { id: "G2", x: 520, y: 350, title: "Khalasi", offset: Math.random() * 100 },
    { id: "O1", x: 100, y: 50, title: "Bridge Song", offset: Math.random() * 100 }
];

// ==========================================
// 2. ENGINE VARS
// ==========================================
let player = { x: 0, y: 0, size: 8, speed: 6 };
let camera = { x: 0, y: 0, zoom: 1, targetZoom: 1 };
let keys = {};
let currentSong = null;
let time = 0; // The master clock for animation

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
window.addEventListener('wheel', e => {
    e.preventDefault();
    camera.targetZoom -= e.deltaY * 0.001;
    camera.targetZoom = Math.max(0.2, Math.min(3.0, camera.targetZoom));
}, { passive: false });

// ==========================================
// 3. THE LOOP
// ==========================================
function draw() {
    // 3.1 Update Time & Physics
    time += 0.05; // Speed of the bobbing
    if (keys['w'] || keys['arrowup']) player.y -= player.speed / camera.zoom;
    if (keys['s'] || keys['arrowdown']) player.y += player.speed / camera.zoom;
    if (keys['a'] || keys['arrowleft']) player.x -= player.speed / camera.zoom;
    if (keys['d'] || keys['arrowright']) player.x += player.speed / camera.zoom;
    
    camera.zoom += (camera.targetZoom - camera.zoom) * 0.1;

    // 3.2 Draw Background (Vibrant Mode)
    ctx.fillStyle = "#020202"; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.scale(camera.zoom, camera.zoom);
    ctx.translate(-player.x, -player.y);

    // BLEND MODE: SCREEN (Makes overlaps brighter)
    ctx.globalCompositeOperation = "screen";

    anchors.forEach(anchor => {
        const grad = ctx.createRadialGradient(anchor.x, anchor.y, 0, anchor.x, anchor.y, anchor.radius);
        grad.addColorStop(0, anchor.color);
        grad.addColorStop(1, "rgba(0,0,0,0)");
        
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(anchor.x, anchor.y, anchor.radius, 0, Math.PI * 2);
        ctx.fill();
    });

    // Reset Blend Mode for Objects
    ctx.globalCompositeOperation = "source-over";

    // 3.3 Draw Songs (The Floating Logic)
    let touchingAnySong = false;

    songs.forEach(song => {
        // Calculate Floating Position (Sine Wave)
        // We float Y position by +/- 5 pixels
        const floatY = song.y + Math.sin(time + song.offset) * 5;
        
        // Check Distance (Player vs Floating Bubble)
        const dx = player.x - song.x;
        const dy = player.y - floatY; // Use floatY for accurate collision!
        const dist = Math.sqrt(dx*dx + dy*dy);
        
        // Dynamic Size: If touching, grow to 40, else 30
        const isTouching = dist < (30 + player.size);
        const currentRadius = isTouching ? 45 : 30; // The "Pop" effect

        // Draw The Bubble
        ctx.beginPath();
        ctx.arc(song.x, floatY, currentRadius, 0, Math.PI * 2);
        
        if (isTouching) {
            // Active Style
            touchingAnySong = true;
            ctx.shadowBlur = 20; // Glow effect
            ctx.shadowColor = "white";
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.shadowBlur = 0; // Reset
            
            // UI Logic
            if (currentSong !== song.id) {
                currentSong = song.id;
                npTitle.innerText = song.title;
                npBox.style.display = "block";
            }
        } else {
            // Passive Style (Glassy)
            ctx.fillStyle = "rgba(255,255,255,0.1)";
            ctx.strokeStyle = "rgba(255,255,255,0.5)";
            ctx.lineWidth = 2;
            ctx.fill();
            ctx.stroke();
        }

        // Text Labels (Only if zoomed in)
        if (camera.zoom > 0.6) {
             ctx.fillStyle = isTouching ? "black" : "white"; // Invert text if active
             if (!isTouching) ctx.fillStyle = "rgba(255,255,255,0.8)";
             
             ctx.font = isTouching ? "bold 12px Arial" : "10px Arial";
             ctx.textAlign = "center";
             ctx.fillText(song.title, song.x, floatY + currentRadius + 15);
        }
    });

    if (!touchingAnySong && currentSong !== null) {
        currentSong = null;
        npBox.style.display = "none";
    }

    // 3.4 Draw Player
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>